{% extends "base.html" %}

{% block content %}
<div class="jumbotron">
    <h1 class="display-4">Welcome to Schwab OAuth App</h1>
    <p class="lead">This application demonstrates OAuth 2.0 authentication with Schwab's API.</p>
    {% if 'logged_in' not in session %}
        <a href="{{ url_for('routes_bp.login') }}" class="btn btn-primary btn-lg">Login with Schwab</a>
    {% endif %}
    <a href="{{ url_for('routes_bp.profile') }}" class="btn btn-secondary btn-lg mt-2">View Profile</a>
    {% if 'logged_in' in session %}
        <a href="#" id="testRefreshBtn" class="btn btn-info btn-lg mt-2">Test Token Refresh</a>
    {% endif %}
</div>
<div id="refreshResult" class="mt-4"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var testRefreshBtn = document.getElementById('testRefreshBtn');
    if (testRefreshBtn) {
        testRefreshBtn.addEventListener('click', function(e) {
            e.preventDefault();
            fetch("{{ url_for('routes_bp.test_refresh') }}")
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('refreshResult');
                resultDiv.innerHTML = `
                    <h3>Token Refresh Result</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while refreshing the token. Please try again.');
            });
        });
    }
});
</script>
{% endblock %}
